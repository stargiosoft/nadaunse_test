# 에러 페이지 노출 로직 검증 가이드

## 📋 구현 완료 사항

### ✅ 1. ErrorBoundary 컴포넌트 생성
- **경로**: `/components/ErrorBoundary.tsx`
- **역할**: React 렌더링 중 발생하는 에러를 자동으로 캐치하고 분류
- **자동 에러 타입 판별**:
  - 네트워크 에러 (`Failed to fetch`, `NetworkError`) → `network`
  - 503 에러 (`Service Unavailable`) → `503`
  - 기타 서버 에러 → `500`
- **콘솔 로깅**: 모든 에러를 상세하게 콘솔에 기록 (Sentry 연동 시 활용 가능)

### ✅ 2. App.tsx 에러 바운더리 적용
- 전체 앱을 `<ErrorBoundary>`로 감싸서 모든 렌더링 에러 캐치
- 404 처리: `Route path="*"`를 ErrorPage로 변경 (기존 홈 리다이렉트 대신)

### ✅ 3. 4가지 에러 타입 페이지 완성
- 404 (페이지 없음)
- 500 (서버 내부 오류)
- 503 (서비스 과부하)
- network (인터넷 연결 끊김)

---

## 🧪 에러 케이스별 검증 방법

### 1️⃣ 404 Error - 페이지 없음

#### 📍 **발생 조건**
- 존재하지 않는 라우트 접근
- 잘못된 URL 직접 입력

#### ✅ **테스트 방법**
```bash
# 브라우저에서 다음 URL 접근
http://localhost:5173/nonexistent-page
http://localhost:5173/product/999999
http://localhost:5173/random/path
```

#### 📊 **기대 결과**
- ✅ ErrorPage type="404" 노출
- ✅ 타이틀: "페이지를 찾을 수 없어요"
- ✅ 설명: "주소가 잘못되었거나\n페이지가 변경되었을 수 있어요."
- ✅ 버튼: "홈으로 가기" (단일 버튼)
- ✅ 아이콘: 문서 아이콘 (Figma SVG)

#### 🔍 **콘솔 확인**
```javascript
// 콘솔에 에러 로그 없음 (정상 404 라우팅)
```

---

### 2️⃣ 500 Error - 서버 내부 오류

#### 📍 **발생 조건**
- React 컴포넌트 렌더링 중 에러
- Edge Function / API에서 500 응답 반환
- JavaScript 런타임 에러

#### ✅ **테스트 방법 A: 컴포넌트 에러 (개발 환경)**
```tsx
// 임시로 HomePage.tsx나 다른 컴포넌트에 추가
throw new Error('500 Server Error Test');
```

#### ✅ **테스트 방법 B: DEV 라우트**
```bash
http://localhost:5173/error/500
```

#### 📊 **기대 결과**
- ✅ ErrorPage type="500" 노출
- ✅ 타이틀: "서버에 문제가 발생했어요"
- ✅ 설명: "일시적인 오류로 페이지를 불러오지 못했어요.\n잠시 후 다시 시도해주세요."
- ✅ 버튼: "홈으로 가기" + "다시 시도하기" (2버튼)
- ✅ 아이콘: 구름+느낌표 (Figma SVG)

#### 🔍 **콘솔 확인**
```javascript
[ErrorBoundary] 에러 캐치: Error: 500 Server Error Test
[ErrorBoundary] → 500 서버 에러로 분류
[ErrorBoundary] 상세 정보: { error: {...}, errorInfo: {...}, errorType: "500" }
```

---

### 3️⃣ 503 Error - 서비스 과부하

#### 📍 **발생 조건**
- 서버에서 503 응답 반환
- Edge Function 타임아웃 또는 과부하
- DB 연결 실패 (일시적 사용 불가)

#### ✅ **테스트 방법 A: 컴포넌트 에러**
```tsx
// 임시로 컴포넌트에 추가
throw new Error('503 Service Unavailable');
```

#### ✅ **테스트 방법 B: DEV 라우트**
```bash
http://localhost:5173/error/503
```

#### 📊 **기대 결과**
- ✅ ErrorPage type="503" 노출
- ✅ 타이틀: "서버가 잠시 과부하 상태예요"
- ✅ 설명: "이용자가 많아 접속이 원활하지 않습니다.\n잠시 후 다시 시도해주세요."
- ✅ 버튼: "홈으로 가기" + "다시 시도하기" (2버튼)
- ✅ 아이콘: 콘(traffic) 아이콘 (Figma SVG)

#### 🔍 **콘솔 확인**
```javascript
[ErrorBoundary] 에러 캐치: Error: 503 Service Unavailable
[ErrorBoundary] → 503 서비스 과부하로 분류
[ErrorBoundary] 상세 정보: { error: {...}, errorInfo: {...}, errorType: "503" }
```

---

### 4️⃣ Network Error - 인터넷 연결 끊김

#### 📍 **발생 조건**
- 오프라인 상태
- fetch / axios 네트워크 에러 발생
- `TypeError: Failed to fetch`
- WiFi/데이터 연결 끊김

#### ✅ **테스트 방법 A: 컴포넌트 에러**
```tsx
// 임시로 컴포넌트에 추가
throw new TypeError('Failed to fetch');
```

#### ✅ **테스트 방법 B: DEV 라우트**
```bash
http://localhost:5173/error/network
```

#### ✅ **테스트 방법 C: 실제 네트워크 차단**
1. Chrome DevTools > Network 탭
2. "Offline" 모드 선택
3. 페이지 새로고침 또는 API 호출 트리거

#### 📊 **기대 결과**
- ✅ ErrorPage type="network" 노출
- ✅ 타이틀: "인터넷 연결이 불안정해요"
- ✅ 설명: "와이파이나 데이터를 확인한 뒤\n다시 시도해주세요."
- ✅ 버튼: "홈으로 가기" + "다시 시도하기" (2버튼)
- ✅ 아이콘: 와이파이+X 아이콘 (Figma SVG)

#### 🔍 **콘솔 확인**
```javascript
[ErrorBoundary] 에러 캐치: TypeError: Failed to fetch
[ErrorBoundary] → 네트워크 에러로 분류
[ErrorBoundary] 상세 정보: { error: {...}, errorInfo: {...}, errorType: "network" }
```

---

## 🔧 에러 타입 자동 판별 로직

### ErrorBoundary.tsx의 판별 알고리즘

```typescript
// 네트워크 에러 감지
if (
  error.message.includes('Failed to fetch') ||
  error.message.includes('Network request failed') ||
  error.message.includes('NetworkError') ||
  error.name === 'NetworkError' ||
  error.name === 'TypeError' && error.message.includes('fetch')
) {
  errorType = 'network';
}
// 503 에러 감지
else if (
  error.message.includes('503') ||
  error.message.includes('Service Unavailable') ||
  error.message.includes('over capacity')
) {
  errorType = '503';
}
// 기본: 500 서버 에러
else {
  errorType = '500';
}
```

---

## 📊 전체 에러 페이지 비교표

| 에러 타입 | 아이콘 | 타이틀 | 버튼 구성 | 분류 조건 |
|---|---|---|---|---|
| **404** | 📄 문서 | 페이지를 찾을 수 없어요 | 단일 (홈으로) | 존재하지 않는 라우트 |
| **500** | ☁️ 구름+느낌표 | 서버에 문제가 발생했어요 | 2버튼 | 일반 서버 에러 |
| **503** | 🚧 콘(traffic) | 서버가 잠시 과부하 상태예요 | 2버튼 | 503 메시지 포함 |
| **network** | 📶 와이파이+X | 인터넷 연결이 불안정해요 | 2버튼 | Failed to fetch 등 |

---

## 💡 추가 기능

### 1. DEV 모드 표시
- 개발 환경에서는 에러 페이지 하단에 `[DEV] XXX 에러 페이지 미리보기` 표시
- `import.meta.env.DEV`로 분기 처리

### 2. 콘솔 에러 로깅
- 모든 에러는 `console.error`로 상세하게 로깅됨
- 향후 Sentry 연동 시 `componentDidCatch`에서 전송 가능

```typescript
componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
  // Sentry 전송 예시:
  // Sentry.captureException(error, { contexts: { react: { componentStack: errorInfo.componentStack } } });
  
  console.error('[ErrorBoundary] 상세 정보:', {
    error: {
      name: error.name,
      message: error.message,
      stack: error.stack,
    },
    errorInfo: {
      componentStack: errorInfo.componentStack,
    },
    errorType: this.state.errorType,
  });
}
```

### 3. Framer Motion 애니메이션
- 모든 에러 페이지에 순차 떠오름 애니메이션 적용
- 아이콘 → 타이틀 → 설명 → 버튼 순서로 등장

---

## 🚀 프로덕션 환경 대응

### dev / prod 공통 사용
- ✅ ErrorBoundary는 dev/prod 모두 동작
- ✅ DEV 표시만 환경에 따라 분기
- ✅ 모든 에러 타입 자동 판별

### 네트워크 vs 서버 에러 구분
- ✅ `Failed to fetch` → network 에러
- ✅ `500 Internal Server Error` → 500 에러
- ✅ `503 Service Unavailable` → 503 에러

---

## ✅ 검증 체크리스트

### 404 에러
- [ ] `/nonexistent-page` 접근 시 404 페이지 노출
- [ ] 문서 아이콘 표시
- [ ] "홈으로 가기" 버튼 클릭 시 `/`로 이동

### 500 에러
- [ ] 컴포넌트 에러 발생 시 500 페이지 노출
- [ ] 구름+느낌표 아이콘 표시
- [ ] "홈으로 가기" 클릭 시 `/`로 이동
- [ ] "다시 시도하기" 클릭 시 `window.location.reload()`

### 503 에러
- [ ] "503" 또는 "Service Unavailable" 에러 시 503 페이지 노출
- [ ] 콘 아이콘 표시
- [ ] 2버튼 정상 동작

### Network 에러
- [ ] "Failed to fetch" 에러 시 network 페이지 노출
- [ ] 와이파이+X 아이콘 표시
- [ ] 2버튼 정상 동작
- [ ] 오프라인 모드에서 API 호출 시 정상 동작

### 공통 기능
- [ ] 모든 에러 타입에서 Framer Motion 애니메이션 작동
- [ ] DEV 모드에서만 "[DEV]" 표시
- [ ] 콘솔에 에러 로그 출력
- [ ] 404 / 500 / 503 / network 페이지가 서로 독립적으로 동작

---

## 📝 향후 개선 사항

### 1. Sentry 연동
- ErrorBoundary의 `componentDidCatch`에서 Sentry로 에러 전송
- 사용자 정보, 에러 스택, 브라우저 정보 함께 전송

### 2. 에러 복구 기능
- 특정 에러에서 자동 복구 시도 (예: 3초 후 자동 재시도)
- 사용자가 "다시 시도하기" 버튼을 누르지 않아도 자동 처리

### 3. 커스텀 에러 메시지
- API 에러 응답에서 사용자 친화적 메시지 추출
- 서버에서 전달한 에러 메시지를 ErrorPage에 표시

---

## 🎉 완료!

이제 모든 에러 상황에서 일관된 UI로 사용자에게 에러 정보를 전달할 수 있어요!

### 테스트 URL 모음 (DEV)
- 404: `http://localhost:5173/error/404`
- 500: `http://localhost:5173/error/500`
- 503: `http://localhost:5173/error/503`
- network: `http://localhost:5173/error/network`
